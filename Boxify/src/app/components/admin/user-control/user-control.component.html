<div class="container">
  <div class="header">
    <h1>User Management</h1>
    <p-toolbar>
      <ng-template #start>
        <p-button icon="pi pi-refresh" (click)="loadUsers()" text severity="secondary" />
      </ng-template>
    </p-toolbar>
  </div>

  <!-- Users Table -->
  <div class="card">
    <p-table
      [value]="users"
      [loading]="loading"
      [paginator]="true"
      [rows]="5"
      [globalFilterFields]="['name', 'email', 'role']"
      responsiveLayout="scroll"
      [tableStyle]="{ 'min-width': '50rem' }">
      
      <ng-template #caption>
        <p-iconfield iconPosition="left">
          <p-inputicon styleClass="pi pi-search" />
          <input pInputText type="text" placeholder="Search users..." />
        </p-iconfield>
      </ng-template>

      <ng-template #header>
        <tr>
          <th pSortableColumn style="width: 20%">Name <p-sortIcon field="name"></p-sortIcon></th>
          <th pSortableColumn style="width: 25%">Email <p-sortIcon field="email"></p-sortIcon></th>
          <th pSortableColumn style="width: 15%">Role <p-sortIcon field="role"></p-sortIcon></th>
          <th style="width: 15%">Status</th>
          <th style="width: 25%">Actions</th>
        </tr>
      </ng-template>

      <ng-template #body let-user>
        <tr>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>
            <p-tag 
              [value]="user.role" 
              [severity]="user.role === 'admin' ? 'danger' : 'info'">
            </p-tag>
          </td>
          <td>
            <p-tag 
              [value]="getStatusText(user.status)" 
              [severity]="user.status ? 'success' : 'warn'">
            </p-tag>
          </td>
          <td>
            <p-button
              severity="warn"
              icon="pi pi-pencil"
              (click)="openEditDialog(user)"
              class="p-button-rounded p-button-info p-button-text mr-2"
              pTooltip="Edit User"
              tooltipPosition="bottom">
            </p-button>
            <p-button
              [severity]="user.status ? 'danger' : 'success'"
              [icon]="user.status ? 'pi pi-ban' : 'pi pi-check'"
              (click)="confirmSuspendUser(user)"
              [class]="user.status ? 'p-button-rounded p-button-warning p-button-text' : 'p-button-rounded p-button-success p-button-text'"
              [pTooltip]="user.status ? 'Suspend User' : 'Activate User'"
              tooltipPosition="bottom">
            </p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template #emptymessage>
        <tr>
          <td colspan="5" class="text-center p-4">
            No users found.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Edit User Dialog -->
  <p-dialog
    header="Edit User"
    [(visible)]="displayEditDialog"
    [modal]="true"
    [style]="{ width: '50vw' }"
    [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
    (onHide)="closeDialog()">
    
    <div *ngIf="editingUser" class="edit-form">
      <div class="field">
        <p-floatlabel variant="on" class="mt-2">
          <input
            pInputText
            id="name"
            [(ngModel)]="editingUser.name"
            class="w-full" />
          <label for="name">Name</label>
        </p-floatlabel>
      </div>

      <div class="field">
        <p-floatlabel variant="on" >
          <input
            pInputText
            id="email"
            [(ngModel)]="editingUser.email"
            type="email"
            class="w-full" />
          <label for="email">Email</label>
        </p-floatlabel>
      </div>

      <div class="field">
        <label for="role">Role</label>
        <p-dropdown
          id="role"
          [(ngModel)]="editingUser.role"
          [options]="roleOptions"
          optionLabel="label"
          optionValue="value"
          placeholder="Select a role"
          [showClear]="true"
          class="w-full">
        </p-dropdown>
      </div>

      <div class="field">
        <label for="status">Status</label>
        <p-togglebutton
          id="status"
          [(ngModel)]="editingUser.status"
          onLabel="Active"
          offLabel="Suspended"
          [style]="{ width: '100%' }">
        </p-togglebutton>
      </div>
    </div>

    <ng-template #footer>
      <p-button
        label="Cancel"
        icon="pi pi-times"
        (click)="closeDialog()"
        class="p-button-text">
      </p-button>
      <p-button
        label="Save"
        icon="pi pi-check"
        (click)="saveUser()">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirmation Dialog for Status Change -->
  <p-confirmDialog [style]="{ width: '50vw' }" [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"></p-confirmDialog>
</div>